<%= turbo_frame_tag dom_id(@version) do  %>
<%= turbo_frame_tag dom_id_history_of(@version) do %>
  <div class="bg-white p-6 shadow-xl relative rounded-lg">

    <%= render partial: "admin/history/version_header",
               locals: {
                 title: @title,
                 version: @version,
                 event_name: @event_name,
                 item: @most_recent_item,
                 user_name: @user_name,
                 user_avatar_url: @user_avatar_url
               } %>

      <%= render partial: "admin/history/version_content",
                 locals: {
                   version: @version,
                   item: @item_as_changed,
                   type_of_change: @version.event
                 } %>

    <nav class="flex gap-4 items-center justify-end">
      <% if (@version.index == @most_recent_item.versions.count - 1) && @version.item %>
        <%# This is the newest version, and item exists. %>
        <%= button_to polymorphic_path(@most_recent_item),
                      method: :delete,
                      class: "flex gap-1 items-center hover:text-lnu-pink focus:outline-lnu-pink",
                      data: { turbo_method: :delete, turbo_confirm: "Er du sikker på at du vil slette innholdet?" } do %>
          <%= inline_svg "delete", class: "h-4 w-4" %>
          Slett <%= @field %>
        <% end %>
        <%= button_to edit_polymorphic_path(@most_recent_item),
                      data: { turbo: false },
                      method: :get,
                      class: "edit-button" do  %>
          <%= inline_svg "edit", class: "h-4 w-4" %>
          Rediger <%= @field %>
        <% end %>
      <% elsif @version.index == @most_recent_item.versions.count - 1 %>
        <%# This is the newest version, but item is destroyed. %>
        <%= button_to admin_history_revert_changes_path(id: @version.id), method: :post, class: "edit-button" do %>
          <%= inline_svg "history", class: "h-4 w-4" %>
          Gjenopprett <%= @field %>
        <% end %>
      <% elsif @version.event == "destroy" %>
        <%= button_to polymorphic_path(@most_recent_item),
                      method: :delete,
                      class: "flex gap-1 items-center hover:text-lnu-pink focus:outline-lnu-pink",
                      data: { turbo_method: :delete, turbo_confirm: "Er du sikker på at du vil slette innholdet?" } do %>
          <%= inline_svg "delete", class: "h-4 w-4" %>
          Slett <%= @field %> på ny
        <% end %>
      <% else %>
        <%# This is not the newest version, offer a revert button %>
        <%= button_to admin_history_revert_changes_path(id: @version.next.id), method: :post, class: "edit-button" do %>
          <%= inline_svg "history", class: "h-4 w-4" %>
          Gjenopprett denne versjonen
        <% end %>
      <% end %>
    </nav>

  </div>
<% end %>
<% end %>